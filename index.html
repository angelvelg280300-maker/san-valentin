<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Para ti ❤️</title>
  <style>
    :root{ --bg:#f6f0e7; --card:#fff8ef; --text:#2a2a2a; --muted:#5a5a5a; }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100svh; display:grid; place-items:center; padding:18px;
      background: linear-gradient(180deg, #2b0036, #130018);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .frame{
      width:min(980px,96vw); border-radius:26px; padding:16px;
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
      backdrop-filter:blur(10px);
    }
    .card{
      background:var(--card); border-radius:22px; overflow:hidden;
      box-shadow:0 24px 80px rgba(0,0,0,.35);
    }
    .content{ display:grid; grid-template-columns:1.1fr 1fr; min-height:520px; }
    .left{ padding:32px 26px 18px; color:var(--text); }
    .left h1{ font-size:18px; font-weight:700; margin:0 0 18px; }
    .poem{ font-size:22px; line-height:1.35; margin:0 0 16px; white-space:pre-line; }
    .sig{ margin-top:10px; font-size:20px; font-weight:650; }
    .divider{ height:1px; background:rgba(0,0,0,.2); margin:16px 0 14px; }
    .timerLabel{ font-size:18px; color:var(--muted); margin:0 0 6px; }
    .timer{ font-size:34px; font-weight:800; letter-spacing:.3px; }
    .timer small{ font-size:16px; font-weight:650; color:var(--muted); margin-right:6px; }

    .right{ background:var(--bg); display:grid; place-items:center; padding:12px; }
    canvas{
      width:100%; max-width:420px; height:100%; max-height:520px; aspect-ratio:4/5;
      border-radius:18px; background:linear-gradient(180deg,#f7f0e7,#f2e7db);
      border:1px solid rgba(0,0,0,.12);
    }
    .bottomBar{ height:6px; background:rgba(0,0,0,.08); }
    @media (max-width:860px){
      .content{grid-template-columns:1fr;}
      .poem{font-size:20px;}
      .timer{font-size:30px;}
    }
  </style>
</head>
<body>
  <div class="frame">
    <div class="card">
      <div class="content">
        <div class="left">
          <h1 id="title">Para el amor de mi vida:</h1>

          <div class="poem" id="poem">Si pudiera elegir un lugar
seguro, sería a tu lado.

Cuanto más tiempo estoy
contigo más te amo.</div>

          <div class="sig" id="sig">— Te amo ❤️</div>

          <div class="divider"></div>

          <div class="timerLabel">Mi amor por ti comenzó hace…</div>
          <div class="timer">
            <span id="days">0</span> <small>días</small>
            <span id="hours">00</span> <small>horas</small>
            <span id="mins">00</span> <small>min</small>
            <span id="secs">00</span> <small>seg</small>
          </div>
        </div>

        <div class="right">
          <canvas id="c"></canvas>
        </div>
      </div>
      <div class="bottomBar"></div>
    </div>
  </div>

<script>
/* =========================
   CONFIG
   ========================= */
const CONFIG = {
  nombrePareja: "Metztli Rebeca Guadarrama Reyes",

  // 11/08/2024 (dd/mm/yyyy) = 11 de agosto 2024
  inicio: { y: 2024, m: 8, d: 11, hh: 0, mm: 0, ss: 0 },

  // Animación
  growMs: 2200,          // ramas (rápido)
  canopyStartMs: 1600,   // empiezan corazones antes de terminar ramas
  canopyFillMs: 2600,    // tiempo en completar la copa

  // Copa de corazones (lo principal)
  canopyHearts: 750,     // MUCHOS corazones
  heartSizeMin: 20,      // px (visible)
  heartSizeMax: 36,      // px (visible)
  branchAlphaBefore: 0.65,
  branchAlphaAfter: 0.14, // ramas de fondo
};

/* =========================
   Textos (forzados)
   ========================= */
document.getElementById("title").textContent =
  `Para el amor de mi vida, ${CONFIG.nombrePareja}:`;
document.getElementById("sig").textContent = "— Te amo ❤️";

/* =========================
   Contador (sin ambigüedad)
   ========================= */
const startDate = new Date(
  CONFIG.inicio.y, CONFIG.inicio.m - 1, CONFIG.inicio.d,
  CONFIG.inicio.hh, CONFIG.inicio.mm, CONFIG.inicio.ss
);

const elDays = document.getElementById("days");
const elHours = document.getElementById("hours");
const elMins = document.getElementById("mins");
const elSecs = document.getElementById("secs");

function tickTimer(){
  const now = new Date();
  const diffMs = Math.max(0, now - startDate);
  const totalSec = Math.floor(diffMs / 1000);

  const days = Math.floor(totalSec / 86400);
  const hours = Math.floor((totalSec % 86400) / 3600);
  const mins  = Math.floor((totalSec % 3600) / 60);
  const secs  = totalSec % 60;

  elDays.textContent = String(days);
  elHours.textContent = String(hours).padStart(2,"0");
  elMins.textContent  = String(mins).padStart(2,"0");
  elSecs.textContent  = String(secs).padStart(2,"0");
}
tickTimer();
setInterval(tickTimer, 1000);

/* =========================
   Canvas setup
   ========================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize(){
  const dpr = Math.min(2, window.devicePixelRatio || 1);
  const cssW = canvas.getBoundingClientRect().width;
  const cssH = canvas.getBoundingClientRect().height;
  canvas.width  = Math.floor(cssW * dpr);
  canvas.height = Math.floor(cssH * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0); // dibujar en "px CSS"
}
resize();

/* =========================
   Helpers + RNG estable
   ========================= */
function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }
function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }
function easeOutBack(t){
  const c1=1.70158, c3=c1+1;
  return 1 + c3*Math.pow(t-1,3) + c1*Math.pow(t-1,2);
}
function xfnv1a(str){
  let h = 2166136261 >>> 0;
  for (let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function mulberry32(a){
  return function(){
    let t = a += 0x6D2B79F5;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
const rand = mulberry32(xfnv1a(`${CONFIG.nombrePareja}|${CONFIG.inicio.y}-${CONFIG.inicio.m}-${CONFIG.inicio.d}`));

/* =========================
   Árbol (ramas suaves)
   ========================= */
const segments = [];
function addBranch(x1,y1, angle, length, thickness, depth, maxDepth){
  const x2 = x1 + Math.cos(angle) * length;
  const y2 = y1 + Math.sin(angle) * length;
  segments.push({x1,y1,x2,y2, thickness, rs:0, re:0});

  if (depth >= maxDepth || length < 18) return;

  const branches = (rand() < 0.28) ? 3 : 2;
  for (let i=0;i<branches;i++){
    const spread = (branches===3) ? (i-1) : (i===0 ? -1 : 1);
    const a2 = angle + spread*(0.55 + rand()*0.20) + (rand()*0.30 - 0.15);
    const l2 = length * (0.72 + rand()*0.10);
    const th2 = thickness * (0.72 + rand()*0.10);
    addBranch(x2, y2, a2, l2, th2, depth+1, maxDepth);
  }
}

function buildBranches(){
  segments.length = 0;
  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;
  const rootX = W * 0.52;
  const rootY = H * 0.92;

  // tronco + ramas
  addBranch(rootX, rootY, -Math.PI/2, H*0.22, 14, 0, 6);

  // tiempos de crecimiento
  const total = segments.length;
  for (let i=0;i<total;i++){
    const start = (i / total) * CONFIG.growMs;
    segments[i].rs = start;
    segments[i].re = start + (380 + rand()*240);
  }
}

/* =========================
   Copa de corazones (forma corazón)
   ========================= */
const canopy = [];

function heartMask(u, v){
  // (x^2 + y^2 - 1)^3 - x^2 y^3 <= 0
  const x = u, y = v;
  const a = (x*x + y*y - 1);
  return (a*a*a - x*x*y*y*y) <= 0;
}

function buildCanopy(){
  canopy.length = 0;

  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  // Centro de la copa (arriba del tronco)
  const cx = W * 0.52;
  const cy = H * 0.36;

  // Radio relativo
  const R = Math.min(W, H) * 0.36;

  const start = CONFIG.canopyStartMs;
  for (let i=0;i<CONFIG.canopyHearts;i++){
    // rejection sampling dentro de un corazón
    let u=0, v=0, tries=0;
    do{
      u = (rand()*2.4 - 1.2);
      v = (rand()*2.4 - 1.2);
      tries++;
    } while(!heartMask(u, -v) && tries < 60);

    const x = cx + u * R;
    const y = cy + v * R;

    const size = CONFIG.heartSizeMin + rand()*(CONFIG.heartSizeMax - CONFIG.heartSizeMin);
    const rot  = (rand()*Math.PI*2);
    const hue  = Math.floor(rand()*26) - 13;
    const alpha = 0.78 + rand()*0.22;

    canopy.push({
      x, y, size, rot, hue, alpha,
      appear: start + rand()*CONFIG.canopyFillMs
    });
  }
}

/* =========================
   Dibujo de corazón (tamaño EN PIXELES)
   ========================= */
function drawHeartPx(x, y, wPx, alpha, rot, hueShift){
  // El path tiene ancho ~3.2 unidades, convertimos a pixeles:
  const s = wPx / 3.2;

  ctx.save();
  ctx.globalAlpha = alpha;
  ctx.translate(x,y);
  ctx.rotate(rot);
  ctx.scale(s, s);

  const g = ctx.createLinearGradient(-1.2,-1.2, 1.2, 1.2);
  g.addColorStop(0, `hsl(${345+hueShift}, 92%, 56%)`);
  g.addColorStop(1, `hsl(${356+hueShift}, 96%, 72%)`);
  ctx.fillStyle = g;

  ctx.beginPath();
  ctx.moveTo(0, -0.35);
  ctx.bezierCurveTo(0.7, -1.15, 1.6, -0.25, 0, 1.0);
  ctx.bezierCurveTo(-1.6, -0.25, -0.7, -1.15, 0, -0.35);
  ctx.closePath();
  ctx.fill();

  ctx.restore();
}

/* =========================
   Build + Animación
   ========================= */
function buildAll(){
  resize();
  buildBranches();
  buildCanopy();
}
buildAll();
window.addEventListener("resize", buildAll);

const t0 = performance.now();
function loop(now){
  const t = now - t0;
  const W = canvas.getBoundingClientRect().width;
  const H = canvas.getBoundingClientRect().height;

  ctx.clearRect(0,0,W,H);

  // sombra base
  ctx.save();
  ctx.globalAlpha = 0.06;
  ctx.fillStyle = "#000";
  ctx.beginPath();
  ctx.ellipse(W*0.52, H*0.94, W*0.22, H*0.03, 0, 0, Math.PI*2);
  ctx.fill();
  ctx.restore();

  // ramas (de frente al inicio, luego se apagan)
  const branchAlpha = (t < CONFIG.canopyStartMs) ? CONFIG.branchAlphaBefore : CONFIG.branchAlphaAfter;

  for (const seg of segments){
    const local = clamp((t - seg.rs) / (seg.re - seg.rs), 0, 1);
    if (local <= 0) continue;

    const p = easeOutCubic(local);
    const x = seg.x1 + (seg.x2 - seg.x1) * p;
    const y = seg.y1 + (seg.y2 - seg.y1) * p;

    ctx.lineCap = "round";
    ctx.strokeStyle = `rgba(94,59,40,${branchAlpha})`;
    ctx.lineWidth = Math.max(1.2, seg.thickness) * (t < CONFIG.canopyStartMs ? 1.0 : 0.75);
    ctx.beginPath();
    ctx.moveTo(seg.x1, seg.y1);
    ctx.lineTo(x, y);
    ctx.stroke();
  }

  // COPA: corazones grandes y densos (lo que dominas)
  for (const c of canopy){
    const lt = clamp((t - c.appear) / 900, 0, 1);
    if (lt <= 0) continue;

    const pop = easeOutBack(lt);
    const a = c.alpha * clamp(lt*1.2, 0, 1);
    const size = c.size * (0.35 + 0.65*pop);

    drawHeartPx(c.x, c.y, size, a, c.rot, c.hue);
  }

  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
